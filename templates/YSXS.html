<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>云凇学术 - 个人文献管理系统</title>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="icon" href="{{ url_for('static', filename='images/ysxs.ico') }}" type="image/x-icon">
    <style>
        /* 基础动画定义 */
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        .slide-up { animation: slideUp 0.4s ease-out; }
        .pulse-hover { transition: transform 0.2s, box-shadow 0.2s; }
        .pulse-hover:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(37, 99, 235, 0.15); }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        /* 自定义滚动条 */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; border-radius: 4px; }
        ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
        
        /* 搜索结果高亮 */
        .search-highlight { background-color: rgba(251, 191, 36, 0.3); padding: 0 2px; border-radius: 2px; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 min-h-screen flex flex-col">
    <!-- 顶部导航栏 -->
    <header class="bg-white shadow-sm sticky top-0 z-50 transition-all duration-300" id="navbar">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- 左侧Logo区域 -->
                <div class="flex items-center">
                    <a href="#" class="flex items-center space-x-2">
                        <i class="fa fa-book text-blue-600 text-2xl"></i>
                        <span class="text-xl font-bold text-blue-700">云凇学术</span>
                    </a>
                    
                    <!-- 桌面端导航菜单 -->
                    <nav class="hidden md:ml-10 md:flex md:space-x-8">
                        <a href="#all-docs" class="text-blue-600 border-b-2 border-blue-600 px-1 py-4 text-sm font-medium">全部文献</a>
                        <a href="#collected" class="text-slate-600 hover:text-blue-600 px-1 py-4 text-sm font-medium transition-colors">我的收藏</a>
                        <a href="#categories" class="text-slate-600 hover:text-blue-600 px-1 py-4 text-sm font-medium transition-colors">文献分类</a>
                        <a href="#recent" class="text-slate-600 hover:text-blue-600 px-1 py-4 text-sm font-medium transition-colors">最近浏览</a>
                    </nav>
                </div>
                
                <!-- 右侧功能区 -->
                <div class="flex items-center space-x-4">
                    <!-- 搜索框（桌面端） -->
                    <div class="hidden md:block relative w-64 lg:w-80">
                        <form action="/search" method="get">  <!-- 添加表单标签 -->
                            <input type="text" id="desktop-search" name="query"  placeholder="搜索文献标题、作者、关键词..." 
                                class="w-full pl-10 pr-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                            <button type="submit" class="absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400">  <!-- 搜索图标改为提交按钮 -->
                                <i class="fa fa-search"></i>
                            </button>
                            <button id="search-clear" type="button" class="hidden absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400 hover:text-slate-600">
                                <i class="fa fa-times"></i>
                            </button>
                        </form>
                    </div>
                    
                    <!-- 上传文献按钮 -->
                    <button id="upload-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center space-x-1 transition-colors shadow-sm">
                        <i class="fa fa-upload"></i>
                        <span class="hidden sm:inline">上传文献</span>
                    </button>
                    
                    <!-- 用户头像 -->
                    <div class="relative">
                        <button id="user-menu-btn" class="flex items-center focus:outline-none">
                            <img src="{{ url_for('static', filename='images/avatar1.png') }}" alt="用户头像" class="w-8 h-8 rounded-full object-cover border-2 border-slate-200">
                        </button>
                        <!-- 用户下拉菜单 -->
                        <div id="user-menu" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-2 z-10 fade-in">
                            <a href="#profile" class="block px-4 py-2 text-sm text-slate-700 hover:bg-slate-100">个人资料</a>
                            <a href="#settings" class="block px-4 py-2 text-sm text-slate-700 hover:bg-slate-100">系统设置</a>
                            <a href="#help" class="block px-4 py-2 text-sm text-slate-700 hover:bg-slate-100">帮助中心</a>
                            <div class="border-t border-slate-200 my-1"></div>
                            <a href="#logout" class="block px-4 py-2 text-sm text-red-600 hover:bg-slate-100">退出登录</a>
                        </div>
                    </div>
                    
                    <!-- 移动端菜单按钮 -->
                    <button id="mobile-menu-btn" class="md:hidden focus:outline-none">
                        <i class="fa fa-bars text-xl text-slate-600"></i>
                    </button>
                </div>
            </div>
            
            <!-- 移动端导航菜单 -->
            <div id="mobile-menu" class="md:hidden hidden pb-4 fade-in">
                <!-- 移动端搜索框 -->
                <div class="relative mb-4">
                    <form action="/search" method="get">  <!-- 添加表单标签 -->
                        <input type="text" id="mobile-search" name="query"  
                            placeholder="搜索文献..." 
                            class="w-full pl-10 pr-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <button type="submit" class="absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400">  <!-- 搜索图标改为提交按钮 -->
                            <i class="fa fa-search"></i>
                        </button>
                    </form>
                </div>
                
                <!-- 移动端导航链接 -->
                <nav class="flex flex-col space-y-1">
                    <a href="#all-docs" class="text-blue-600 bg-blue-50 px-3 py-2 rounded-md text-sm font-medium">全部文献</a>
                    <a href="#collected" class="text-slate-600 hover:bg-slate-100 px-3 py-2 rounded-md text-sm font-medium">我的收藏</a>
                    <a href="#categories" class="text-slate-600 hover:bg-slate-100 px-3 py-2 rounded-md text-sm font-medium">文献分类</a>
                    <a href="#recent" class="text-slate-600 hover:bg-slate-100 px-3 py-2 rounded-md text-sm font-medium">最近浏览</a>
                </nav>
            </div>
        </div>
    </header>

    <!-- 主内容区 -->
    <main class="flex-grow container mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <div class="flex flex-col lg:flex-row gap-6">
            <!-- 左侧边栏（筛选和分类） -->
            <aside class="lg:w-64 xl:w-72 shrink-0">
                <div class="bg-white rounded-xl shadow-sm p-4 sticky top-20">
                    <!-- 文献分类 -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-slate-800 mb-3 flex items-center">
                            <i class="fa fa-folder-open text-blue-500 mr-2"></i>文献分类
                        </h3>
                        <ul class="space-y-1">
                            <li>
                                <a href="#" class="flex items-center justify-between px-3 py-2 rounded-lg bg-blue-50 text-blue-600">
                                    <span>全部文献</span>
                                    <span class="bg-blue-100 text-blue-800 text-xs px-2 py-0.5 rounded-full">{{ total_count }}</span>
                                </a>
                            </li>
                            <li>
                                <a href="#" class="flex items-center justify-between px-3 py-2 rounded-lg hover:bg-slate-100 transition-colors">
                                    <span>计算机科学</span>
                                    <span class="bg-slate-100 text-slate-800 text-xs px-2 py-0.5 rounded-full">42</span>
                                </a>
                            </li>
                            <li>
                                <a href="#" class="flex items-center justify-between px-3 py-2 rounded-lg hover:bg-slate-100 transition-colors">
                                    <span>人工智能</span>
                                    <span class="bg-slate-100 text-slate-800 text-xs px-2 py-0.5 rounded-full">35</span>
                                </a>
                            </li>
                            <li>
                                <a href="#" class="flex items-center justify-between px-3 py-2 rounded-lg hover:bg-slate-100 transition-colors">
                                    <span>数学建模</span>
                                    <span class="bg-slate-100 text-slate-800 text-xs px-2 py-0.5 rounded-full">23</span>
                                </a>
                            </li>
                            <li>
                                <a href="#" class="flex items-center justify-between px-3 py-2 rounded-lg hover:bg-slate-100 transition-colors">
                                    <span>物理学</span>
                                    <span class="bg-slate-100 text-slate-800 text-xs px-2 py-0.5 rounded-full">18</span>
                                </a>
                            </li>
                            <li>
                                <a href="#" class="flex items-center justify-between px-3 py-2 rounded-lg hover:bg-slate-100 transition-colors">
                                    <span>生物学</span>
                                    <span class="bg-slate-100 text-slate-800 text-xs px-2 py-0.5 rounded-full">10</span>
                                </a>
                            </li>
                        </ul>
                        <button class="w-full mt-3 text-blue-600 hover:text-blue-700 text-sm font-medium flex items-center justify-center px-3 py-2 rounded-lg border border-dashed border-blue-200 hover:bg-blue-50 transition-colors">
                            <i class="fa fa-plus mr-1"></i>新建分类
                        </button>
                    </div>
                    
                    <!-- 筛选条件 -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-slate-800 mb-3 flex items-center">
                            <i class="fa fa-filter text-blue-500 mr-2"></i>筛选条件
                        </h3>
                        
                        <!-- 发表年份 -->
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-slate-700 mb-2">发表年份</label>
                            <div class="space-y-2">
                                <label class="flex items-center">
                                    <input type="checkbox" class="form-checkbox h-4 w-4 text-blue-600 rounded border-slate-300 focus:ring-blue-500">
                                    <span class="ml-2 text-sm text-slate-600">2024年</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" class="form-checkbox h-4 w-4 text-blue-600 rounded border-slate-300 focus:ring-blue-500">
                                    <span class="ml-2 text-sm text-slate-600">2023年</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" class="form-checkbox h-4 w-4 text-blue-600 rounded border-slate-300 focus:ring-blue-500">
                                    <span class="ml-2 text-sm text-slate-600">2020-2022年</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" class="form-checkbox h-4 w-4 text-blue-600 rounded border-slate-300 focus:ring-blue-500">
                                    <span class="ml-2 text-sm text-slate-600">2020年以前</span>
                                </label>
                            </div>
                        </div>
                        
                        <!-- 文献类型 -->
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-slate-700 mb-2">文献类型</label>
                            <div class="space-y-2">
                                <label class="flex items-center">
                                    <input type="checkbox" class="form-checkbox h-4 w-4 text-blue-600 rounded border-slate-300 focus:ring-blue-500">
                                    <span class="ml-2 text-sm text-slate-600">期刊论文</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" class="form-checkbox h-4 w-4 text-blue-600 rounded border-slate-300 focus:ring-blue-500">
                                    <span class="ml-2 text-sm text-slate-600">会议论文</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" class="form-checkbox h-4 w-4 text-blue-600 rounded border-slate-300 focus:ring-blue-500">
                                    <span class="ml-2 text-sm text-slate-600">学位论文</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" class="form-checkbox h-4 w-4 text-blue-600 rounded border-slate-300 focus:ring-blue-500">
                                    <span class="ml-2 text-sm text-slate-600">技术报告</span>
                                </label>
                            </div>
                        </div>
                        
                        <!-- 排序方式 -->
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-2">排序方式</label>
                            <select class="w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option>最新上传</option>
                                <option>最早上传</option>
                                <option>按标题排序（A-Z）</option>
                                <option>按标题排序（Z-A）</option>
                                <option>按引用量排序</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- 筛选操作按钮 -->
                    <div class="flex space-x-2">
                        <button class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm transition-colors">
                            应用筛选
                        </button>
                        <button class="px-4 py-2 border border-slate-300 rounded-lg text-sm text-slate-600 hover:bg-slate-100 transition-colors">
                            重置
                        </button>
                    </div>
                </div>
            </aside>
            
            <!-- 右侧文献列表区 -->
            <div class="flex-grow">
                <!-- 搜索结果统计 -->
                <div class="bg-white rounded-xl shadow-sm p-4 mb-6 flex flex-col sm:flex-row justify-between items-start sm:items-center">
                    <div>
                        <h2 class="text-xl font-semibold text-slate-800">全部文献</h2>
                        <p class="text-sm text-slate-500 mt-1" id="search-result-count">找到 {{ total_count }} 篇相关文献</p>
                    </div>
                    <div class="mt-3 sm:mt-0 flex items-center space-x-2">
                        <span class="text-sm text-slate-500">显示方式：</span>
                        <button id="list-view-btn" class="p-2 rounded-lg bg-blue-50 text-blue-600">
                            <i class="fa fa-list"></i>
                        </button>
                        <button id="grid-view-btn" class="p-2 rounded-lg text-slate-400 hover:bg-slate-100 transition-colors">
                            <i class="fa fa-th-large"></i>
                        </button>
                    </div>
                </div>
                
                <!-- 搜索结果区域 -->
                <div id="search-results" class="space-y-4">
                    {% for doc in documents %}  <!-- 循环数据库中的每篇文献 -->
                    <div class="bg-white rounded-xl shadow-sm overflow-hidden pulse-hover">
                        <div class="p-5">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="text-lg font-semibold text-slate-800 hover:text-blue-600 transition-colors cursor-pointer">
                                    <a href="{{ url_for('document_detail', doc_id=doc.id) }}" target="_blank">{{ doc.title }}</a>  <!-- 显示标题 -->
                                </h3>
                                <button class="text-slate-400 hover:text-amber-500 transition-colors" title="收藏文献">
                                    <i class="fa fa-star-o text-lg"></i>
                                </button>
                            </div>
                            <p class="text-sm text-slate-600 mb-3">
                                {{ doc.authors }} <span class="text-slate-400 mx-1">|</span> 
                                <span class="text-blue-600 hover:underline cursor-pointer">{{ doc.journal }}</span> <span class="text-slate-400 mx-1">|</span> 
                                {{ doc.year }}, {{ doc.volume }}({{ doc.issue }}): {{ doc.pages }}
                            </p>
                            <p class="text-sm text-slate-600 mb-4 line-clamp-2">
                                {{ doc.abstract }}  <!-- 显示摘要 -->
                            </p>
                            <div class="flex flex-wrap items-center gap-2 text-xs text-slate-500">
                                <!-- 显示标签（按逗号分割） -->
                                {% for tag in doc.tags.split(',') %}
                                <span class="bg-slate-100 px-2 py-1 rounded-full">{{ tag }}</span>
                                {% endfor %}
                                <span class="ml-auto flex items-center">
                                    <i class="fa fa-eye mr-1"></i> {{ doc.view_count }}  <!-- 显示浏览量 -->
                                </span>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                
                <!-- 分页控件 -->
                <div class="mt-8 flex justify-center">
                    <nav class="flex items-center space-x-1">
                        <a href="#" class="px-3 py-2 rounded-lg border border-slate-300 text-slate-600 hover:bg-slate-50 hover:text-blue-600 hover:border-blue-300 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" aria-disabled="true">
                            <i class="fa fa-chevron-left text-sm"></i>
                        </a>
                        <a href="#" class="px-4 py-2 rounded-lg bg-blue-600 text-white font-medium">1</a>
                        <a href="#" class="px-4 py-2 rounded-lg border border-slate-300 text-slate-600 hover:bg-slate-50 hover:text-blue-600 hover:border-blue-300 transition-colors">2</a>
                        <a href="#" class="px-4 py-2 rounded-lg border border-slate-300 text-slate-600 hover:bg-slate-50 hover:text-blue-600 hover:border-blue-300 transition-colors">3</a>
                        <span class="px-4 py-2 text-slate-400">...</span>
                        <a href="#" class="px-4 py-2 rounded-lg border border-slate-300 text-slate-600 hover:bg-slate-50 hover:text-blue-600 hover:border-blue-300 transition-colors">13</a>
                        <a href="#" class="px-3 py-2 rounded-lg border border-slate-300 text-slate-600 hover:bg-slate-50 hover:text-blue-600 hover:border-blue-300 transition-colors">
                            <i class="fa fa-chevron-right text-sm"></i>
                        </a>
                    </nav>
                </div>
            </div>
        </div>
    </main>

    <!-- 页脚 -->
    <footer class="bg-white border-t border-slate-200 py-8 mt-12">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-6 md:mb-0">
                    <div class="flex items-center justify-center md:justify-start">
                        <i class="fa fa-book text-blue-600 text-2xl"></i>
                        <span class="ml-2 text-xl font-bold text-blue-700">云凇学术</span>
                    </div>
                    <p class="mt-2 text-sm text-slate-500 text-center md:text-left">
                        个人学术文献管理系统 © 2024 版权所有
                    </p>
                </div>
                
                <div class="flex flex-wrap justify-center gap-x-8 gap-y-4">
                    <a href="#about" class="text-sm text-slate-600 hover:text-blue-600 transition-colors">关于我们</a>
                    <a href="#help" class="text-sm text-slate-600 hover:text-blue-600 transition-colors">帮助中心</a>
                    <a href="#terms" class="text-sm text-slate-600 hover:text-blue-600 transition-colors">使用条款</a>
                    <a href="#privacy" class="text-sm text-slate-600 hover:text-blue-600 transition-colors">隐私政策</a>
                    <a href="#contact" class="text-sm text-slate-600 hover:text-blue-600 transition-colors">联系我们</a>
                </div>
            </div>
            
            <div class="mt-8 pt-6 border-t border-slate-200 text-center text-sm text-slate-500">
                本系统仅供个人学术研究使用，所有文献资源请遵守相关版权法律法规
            </div>
        </div>
    </footer>

    <!-- 上传文献模态框 -->
    <div id="upload-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden fade-in">
        <div class="bg-white rounded-xl shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-slate-200 flex justify-between items-center">
                <h3 class="text-xl font-semibold text-slate-800">上传新文献</h3>
                <button id="close-modal" class="text-slate-400 hover:text-slate-600 focus:outline-none">
                    <i class="fa fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="p-6">
                <form id="upload-form" class="space-y-6" enctype="multipart/form-data" action="/upload" method="POST">
                    <!-- 文献上传区域 -->
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">上传文献文件</label>
                        <div class="border-2 border-dashed border-slate-300 rounded-lg p-8 text-center hover:border-blue-500 hover:bg-blue-50 transition-colors cursor-pointer" id="drop-area">
                            <input type="file" id="file-upload" name="file" class="hidden" accept=".pdf,.doc,.docx,.ppt,.pptx,.txt">
                            <i class="fa fa-cloud-upload text-4xl text-slate-400 mb-3"></i>
                            <p class="text-sm text-slate-600 mb-2">拖放文件到此处，或</p>
                            <button type="button" id="browse-files" class="text-blue-600 hover:text-blue-700 font-medium text-sm">浏览文件</button>
                            <p class="text-xs text-slate-400 mt-3">支持格式：PDF, DOC, DOCX, PPT, PPTX, TXT（最大50MB）</p>
                        </div>
                        <!-- 文件上传进度条（默认隐藏） -->
                        <div id="upload-progress" class="hidden mt-4">
                            <div class="flex justify-between text-sm text-slate-600 mb-1">
                                <span>上传进度</span>
                                <span id="progress-percent">0%</span>
                            </div>
                            <div class="w-full bg-slate-200 rounded-full h-2.5">
                                <div id="progress-bar" class="bg-blue-600 h-2.5 rounded-full" style="width: 0%"></div>
                            </div>
                        </div>
                        <div id="file-list" class="mt-4 hidden">
                            <h4 class="text-sm font-medium text-slate-700 mb-2">已选择文件：</h4>
                            <ul id="selected-files" class="space-y-2 max-h-40 overflow-y-auto"></ul>
                        </div>
                    </div>
                    
                    <!-- 文献信息填写 -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="doc-title" class="block text-sm font-medium text-slate-700 mb-2">文献标题 <span class="text-red-500">*</span></label>
                            <input type="text" id="doc-title" name="doc-title" class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="请输入文献标题" required>
                        </div>
                        
                        <div>
                            <label for="doc-authors" class="block text-sm font-medium text-slate-700 mb-2">作者 <span class="text-red-500">*</span></label>
                            <input type="text" id="doc-authors" name="doc-authors" class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="作者姓名，多个作者用逗号分隔" required>
                        </div>
                        
                        <div>
                            <label for="doc-journal" class="block text-sm font-medium text-slate-700 mb-2">期刊/会议名称</label>
                            <input type="text" id="doc-journal" name="doc-journal" class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="请输入期刊或会议名称">
                        </div>
                        
                        <div>
                            <label for="doc-year" class="block text-sm font-medium text-slate-700 mb-2">发表年份</label>
                            <input type="number" id="doc-year" name="doc-year" class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="例如：2024">
                        </div>
                        
                        <div>
                            <label for="doc-category" class="block text-sm font-medium text-slate-700 mb-2">文献分类 <span class="text-red-500">*</span></label>
                            <select id="doc-category" name="doc-category" class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                                <option value="">请选择分类</option>
                                <option value="computer">计算机科学</option>
                                <option value="ai">人工智能</option>
                                <option value="math">数学建模</option>
                                <option value="physics">物理学</option>
                                <option value="biology">生物学</option>
                                <option value="other">其他</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="doc-type" class="block text-sm font-medium text-slate-700 mb-2">文献类型 <span class="text-red-500">*</span></label>
                            <select id="doc-type" name="doc-type" class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                                <option value="">请选择类型</option>
                                <option value="journal">期刊论文</option>
                                <option value="conference">会议论文</option>
                                <option value="thesis">学位论文</option>
                                <option value="report">技术报告</option>
                                <option value="other">其他</option>
                            </select>
                        </div>
                    </div>
                    
                    <div>
                        <label for="doc-keywords" class="block text-sm font-medium text-slate-700 mb-2">关键词</label>
                        <input type="text" id="doc-keywords" name="doc-keywords" class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="关键词，多个关键词用逗号分隔">
                    </div>
                    
                    <div>
                        <label for="doc-abstract" class="block text-sm font-medium text-slate-700 mb-2">摘要</label>
                        <textarea id="doc-abstract" name="doc-abstract" rows="4" class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="请输入文献摘要（可选）"></textarea>
                    </div>
                    
                    <div>
                        <label class="flex items-center">
                            <input type="checkbox" class="form-checkbox h-4 w-4 text-blue-600 rounded border-slate-300 focus:ring-blue-500">
                            <span class="ml-2 text-sm text-slate-600">我已确认该文献的版权归属，且上传行为符合相关法律法规</span>
                        </label>
                    </div>
                </form>
            </div>
            
            <div class="p-6 border-t border-slate-200 flex justify-end space-x-4">
                <button id="cancel-upload" class="px-6 py-2 border border-slate-300 rounded-lg text-slate-700 hover:bg-slate-50 transition-colors">
                    取消
                </button>
                <button type="submit" id="submit-upload" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors shadow-sm">
                    确认上传
                </button>
            </div>
        </div>
    </div>

    <!-- JavaScript 功能实现 -->
    <script>
        // DOM元素获取
        const navbar = document.getElementById('navbar');
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');
        const userMenuBtn = document.getElementById('user-menu-btn');
        const userMenu = document.getElementById('user-menu');
        const uploadBtn = document.getElementById('upload-btn');
        const uploadModal = document.getElementById('upload-modal');
        const closeModal = document.getElementById('close-modal');
        const cancelUpload = document.getElementById('cancel-upload');
        const browseFiles = document.getElementById('browse-files');
        const fileUpload = document.getElementById('file-upload');
        const dropArea = document.getElementById('drop-area');
        const submitUpload = document.getElementById('submit-upload');
        const uploadProgress = document.getElementById('upload-progress');
        const progressBar = document.getElementById('progress-bar');
        const progressPercent = document.getElementById('progress-percent');
        const desktopSearch = document.getElementById('desktop-search');
        const mobileSearch = document.getElementById('mobile-search');
        const searchClear = document.getElementById('search-clear');
        const searchResultCount = document.getElementById('search-result-count');
        const searchResults = document.getElementById('search-results');
        const listViewBtn = document.getElementById('list-view-btn');
        const gridViewBtn = document.getElementById('grid-view-btn');

        // 导航栏滚动效果
        window.addEventListener('scroll', () => {
            if (window.scrollY > 10) {
                navbar.classList.add('shadow');
                navbar.classList.remove('shadow-sm');
            } else {
                navbar.classList.remove('shadow');
                navbar.classList.add('shadow-sm');
            }
        });

        // 移动端菜单切换
        mobileMenuBtn.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });

        // 用户菜单切换
        userMenuBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            userMenu.classList.toggle('hidden');
        });

        // 点击页面其他区域关闭用户菜单
        document.addEventListener('click', () => {
            userMenu.classList.add('hidden');
        });

        // 阻止用户菜单内部点击事件冒泡
        userMenu.addEventListener('click', (e) => {
            e.stopPropagation();
        });

        // 上传模态框控制
        uploadBtn.addEventListener('click', () => {
            uploadModal.classList.remove('hidden');
            // 阻止页面滚动
            document.body.style.overflow = 'hidden';
        });

        function closeUploadModal() {
            uploadModal.classList.add('hidden');
            // 恢复页面滚动
            document.body.style.overflow = '';
            // 重置上传表单
            document.getElementById('upload-form').reset();
            uploadProgress.classList.add('hidden');
            progressBar.style.width = '0%';
            progressPercent.textContent = '0%';
            
            // 新增：重置文件选择和文件列表
            const fileUpload = document.getElementById('file-upload');
            const fileList = document.getElementById('file-list');
            const selectedFiles = document.getElementById('selected-files');
            
            // 清空文件输入
            fileUpload.value = '';
            // 隐藏文件列表并清空内容
            fileList.classList.add('hidden');
            selectedFiles.innerHTML = '';
        }

        closeModal.addEventListener('click', closeUploadModal);
        cancelUpload.addEventListener('click', closeUploadModal);

        // 点击模态框外部关闭
        uploadModal.addEventListener('click', (e) => {
            if (e.target === uploadModal) {
                closeUploadModal();
            }
        });

        // 文件上传功能
        browseFiles.addEventListener('click', () => {
            fileUpload.click();
        });

        // 文件选择后处理
        fileUpload.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        // 拖放上传功能
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            dropArea.addEventListener(eventName, highlight, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, unhighlight, false);
        });

        function highlight() {
            dropArea.classList.add('border-blue-500');
            dropArea.classList.add('bg-blue-50');
        }

        function unhighlight() {
            dropArea.classList.remove('border-blue-500');
            dropArea.classList.remove('bg-blue-50');
        }

        dropArea.addEventListener('drop', handleDrop, false);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            handleFiles(files);
        }
        // 统一处理文件选择
        function handleFiles(files) {
        if (files.length > 0) {
            const fileListEl = document.getElementById('file-list');
            const selectedFilesEl = document.getElementById('selected-files');
            
            // 清空现有列表
            selectedFilesEl.innerHTML = '';
            
            // 显示文件列表
            fileListEl.classList.remove('hidden');
            
            // 添加文件到列表
            Array.from(files).forEach((file, index) => {
            // 检查文件大小
            if (file.size > 50 * 1024 * 1024) {
                alert('文件大小不能超过50MB');
                return;
            }
            
            // 检查文件类型
            const ext = file.name.split('.').pop().toLowerCase();
            const allowedExts = ['pdf', 'doc', 'docx', 'ppt', 'pptx', 'txt'];
            if (!allowedExts.includes(ext)) {
                alert('不支持的文件类型');
                return;
            }
            
            // 创建文件列表项
            const li = document.createElement('li');
            li.className = 'flex items-center justify-between p-2 bg-slate-50 rounded-lg';
            li.innerHTML = `
                <div class="flex items-center">
                <i class="fa fa-file-${getIconClass(ext)} text-blue-500 mr-2"></i>
                <span class="text-sm truncate max-w-[70%]">${file.name}</span>
                </div>
                <button type="button" class="text-slate-400 hover:text-red-500 remove-file" data-index="${index}">
                <i class="fa fa-times"></i>
                </button>
            `;
            selectedFilesEl.appendChild(li);
            });
            // 添加删除文件事件
            document.querySelectorAll('.remove-file').forEach(btn => {
            btn.addEventListener('click', function() {
                const index = this.getAttribute('data-index');
                // 实际项目中可能需要更复杂的文件列表管理
                if (files.length <= 1) {
                fileListEl.classList.add('hidden');
                fileUpload.value = '';
                }
                this.closest('li').remove();
            });
            });

            // 尝试从文件名提取标题和作者信息
            extractInfoFromFilename(files[0].name);
        }
        }

        // 根据文件扩展名获取图标类
        function getIconClass(ext) {
            switch(ext) {
                case 'pdf': return 'pdf-o';
                case 'doc': return 'word-o';
                case 'docx': return 'word-o';
                case 'ppt':
                case 'pptx': return 'powerpoint-o';
                case 'txt': return 'text-o';
                default: return '-o';
            }
        }

        // 从文件名提取标题和作者信息（简单实现）
        function extractInfoFromFilename(filename) {
        // 移除文件扩展名
        const baseName = filename.replace(/\.[^\.]+$/, '');
        
        // 常见的文献命名格式处理
        // 格式1: 作者_标题_年份.xxx
        const pattern1 = /^([^_]+)_(.+?)_(\d{4})$/;
        const match1 = baseName.match(pattern1);
        
        // 格式2: 标题 - 作者.xxx
        const pattern2 = /^(.+?) - ([^-]+)$/;
        const match2 = baseName.match(pattern2);
        
        if (match1) {
            // 格式1匹配: 作者_标题_年份
            document.getElementById('doc-authors').value = formatAuthors(match1[1]);
            document.getElementById('doc-title').value = match1[2].replace(/_/g, ' ');
            document.getElementById('doc-year').value = match1[3];
        } else if (match2) {
            // 格式2匹配: 标题 - 作者
            document.getElementById('doc-title').value = match2[1];
            document.getElementById('doc-authors').value = formatAuthors(match2[2]);
        } else {
            // 没有匹配到已知格式，仅填充标题
            document.getElementById('doc-title').value = baseName.replace(/_/g, ' ');
        }
        }

        // 格式化作者名称（处理常见分隔符）
        function formatAuthors(authorsStr) {
        return authorsStr
            .replace(/,/g, '，')  // 替换英文逗号为中文逗号
            .replace(/;/g, '，')  // 分号替换为逗号
            .replace(/_/g, '，'); // 下划线替换为逗号
        }

        // 上传进度
        submitUpload.addEventListener('click', async () => {
            // 验证表单
            const title = document.getElementById('doc-title').value;
            const authors = document.getElementById('doc-authors').value;
            const category = document.getElementById('doc-category').value;
            const docType = document.getElementById('doc-type').value;
            const fileList = fileUpload.files;
            
            if (!title || !authors || !category || !docType || fileList.length === 0) {
                alert('请填写必填项并选择文件');
                return;
            }
            
            // 显示进度条
            uploadProgress.classList.remove('hidden');
            
            // 创建FormData对象
            const formData = new FormData(document.getElementById('upload-form'));
            
            try {
                // 发起真实的文件上传请求
                const response = await fetch('/upload', {
                method: 'POST',
                body: formData,
                onprogress: (e) => {
                    if (e.lengthComputable) {
                    const progress = (e.loaded / e.total) * 100;
                    progressBar.style.width = `${progress}%`;
                    progressPercent.textContent = `${Math.round(progress)}%`;
                    }
                }
                });
                
                if (response.ok) {
                // 上传成功
                setTimeout(() => {
                    closeUploadModal();
                    alert('文献上传成功！');
                    window.location.reload(); // 刷新页面显示新上传的文献
                }, 500);
                } else {
                const error = await response.text();
                throw new Error(error || '上传失败');
                }
            } catch (error) {
                alert('上传出错：' + error.message);
                uploadProgress.classList.add('hidden');
            }
        });

        // 搜索功能实现
        function handleSearch(query) {
            query = query.trim().toLowerCase();
            if (query === '') {
                // 清空搜索，恢复默认显示
                searchResultCount.textContent = '找到 {{ total_count }} 篇相关文献';
                searchClear.classList.add('hidden');
                // 恢复所有文献显示
                const docItems = searchResults.querySelectorAll('.pulse-hover');
                docItems.forEach(item => {
                    item.classList.remove('hidden');
                    // 移除高亮
                    const titles = item.querySelectorAll('h3 a');
                    titles.forEach(title => {
                        title.innerHTML = title.innerHTML.replace(/<span class="search-highlight">([^<]+)<\/span>/g, '$1');
                    });
                    const abstracts = item.querySelectorAll('p.line-clamp-2');
                    abstracts.forEach(abstract => {
                        abstract.innerHTML = abstract.innerHTML.replace(/<span class="search-highlight">([^<]+)<\/span>/g, '$1');
                    });
                });
                return;
            }
            
            searchClear.classList.remove('hidden');
            
            // 模拟搜索逻辑
            const docItems = searchResults.querySelectorAll('.pulse-hover');
            let matchCount = 0;
            
            docItems.forEach(item => {
                const title = item.querySelector('h3 a').textContent.toLowerCase();
                const authors = item.querySelector('p.text-sm').textContent.toLowerCase();
                const abstract = item.querySelector('p.line-clamp-2').textContent.toLowerCase();
                const keywords = item.querySelectorAll('.bg-slate-100');
                let keywordText = '';
                keywords.forEach(kw => {
                    keywordText += kw.textContent.toLowerCase() + ' ';
                });
                
                // 检查是否匹配
                const isMatch = title.includes(query) || authors.includes(query) || 
                               abstract.includes(query) || keywordText.includes(query);
                
                if (isMatch) {
                    matchCount++;
                    item.classList.remove('hidden');
                    
                    // 高亮匹配文本
                    const titleElement = item.querySelector('h3 a');
                    const originalTitle = titleElement.textContent;
                    const regex = new RegExp(`(${query})`, 'gi');
                    titleElement.innerHTML = originalTitle.replace(regex, '<span class="search-highlight">$1</span>');
                    
                    const abstractElement = item.querySelector('p.line-clamp-2');
                    const originalAbstract = abstractElement.textContent;
                    abstractElement.innerHTML = originalAbstract.replace(regex, '<span class="search-highlight">$1</span>');
                } else {
                    item.classList.add('hidden');
                }
            });
            
            // 更新搜索结果计数
            searchResultCount.textContent = `找到 ${matchCount} 篇与 "${query}" 相关的文献`;
        }

        // 桌面端搜索
        desktopSearch.addEventListener('input', (e) => {
            handleSearch(e.target.value);
        });

        // 移动端搜索
        mobileSearch.addEventListener('input', (e) => {
            handleSearch(e.target.value);
        });

        // 清空搜索
        searchClear.addEventListener('click', () => {
            desktopSearch.value = '';
            handleSearch('');
        });

        // 文献列表视图切换
        listViewBtn.addEventListener('click', () => {
            listViewBtn.classList.add('bg-blue-50', 'text-blue-600');
            listViewBtn.classList.remove('text-slate-400', 'hover:bg-slate-100');
            gridViewBtn.classList.remove('bg-blue-50', 'text-blue-600');
            gridViewBtn.classList.add('text-slate-400', 'hover:bg-slate-100');
            
            // 列表视图样式
            const docItems = searchResults.querySelectorAll('.pulse-hover');
            docItems.forEach(item => {
                item.classList.remove('grid', 'md:grid-cols-2', 'gap-4');
                item.classList.add('block');
            });
        });

        gridViewBtn.addEventListener('click', () => {
            gridViewBtn.classList.add('bg-blue-50', 'text-blue-600');
            gridViewBtn.classList.remove('text-slate-400', 'hover:bg-slate-100');
            listViewBtn.classList.remove('bg-blue-50', 'text-blue-600');
            listViewBtn.classList.add('text-slate-400', 'hover:bg-slate-100');
            
            // 网格视图样式
            searchResults.classList.add('grid', 'md:grid-cols-2', 'gap-4');
            const docItems = searchResults.querySelectorAll('.pulse-hover');
            docItems.forEach(item => {
                item.classList.add('h-full');
            });
        });

        // 收藏功能
        const favoriteBtns = document.querySelectorAll('.fa-star-o, .fa-star');
        favoriteBtns.forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.stopPropagation();
                const icon = e.currentTarget;
                if (icon.classList.contains('fa-star-o')) {
                    icon.classList.remove('fa-star-o', 'text-slate-400');
                    icon.classList.add('fa-star', 'text-amber-500');
                    icon.setAttribute('title', '已收藏');
                    // 实际项目中这里应该发送请求到后端更新收藏状态
                } else {
                    icon.classList.remove('fa-star', 'text-amber-500');
                    icon.classList.add('fa-star-o', 'text-slate-400');
                    icon.setAttribute('title', '收藏文献');
                    // 实际项目中这里应该发送请求到后端更新收藏状态
                }
            });
        });

        // 初始化页面
        window.addEventListener('load', () => {
            // 触发一次搜索以初始化显示
            handleSearch('');
        });
    </script>
</body>
</html>